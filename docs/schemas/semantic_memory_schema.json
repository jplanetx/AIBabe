{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pinecone Vector Metadata Schema for Semantic Memory",
  "description": "Defines the structure of metadata associated with semantic memory vectors stored in Pinecone.",
  "type": "object",
  "properties": {
    "vectorId": {
      "type": "string",
      "description": "The unique ID of the vector, corresponding to UserFact.id or UserSemanticPreference.id in Prisma."
    },
    "userId": {
      "type": "string",
      "description": "The ID of the user to whom this memory belongs."
    },
    "sourceSessionId": {
      "type": ["string", "null"],
      "description": "The ID of the chat session where this memory was sourced."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp indicating when the memory was created or last updated."
    },
    "type": {
      "type": "string",
      "enum": ["fact", "preference"],
      "description": "The type of semantic memory."
    },
    "text": {
      "type": "string",
      "description": "The original text content that was embedded."
    },
    "preferenceType": {
      "type": ["string", "null"],
      "description": "Specific type of preference (e.g., TONE, TOPIC_AVOIDANCE, INFO_DEPTH). Only present if type is 'preference'."
    },
    "preferenceValue": {
      "type": ["string", "null"],
      "description": "The value associated with the preference. Only present if type is 'preference'."
    }
  },
  "required": [
    "vectorId",
    "userId",
    "timestamp",
    "type",
    "text"
  ],
  "if": {
    "properties": { "type": { "const": "preference" } }
  },
  "then": {
    "required": ["preferenceType", "preferenceValue"]
  }
}